{
  "openapi": "3.0.0",
  "info": {
    "title": "通用版面解析v3产线",
    "description": "版面解析是一种从文档图像中提取结构化信息的技术，主要用于将复杂的文档版面转换为机器可读的数据格式。这项技术在文档管理、信息提取和数据数字化等领域具有广泛的应用。版面解析通过结合光学字符识别（OCR）、图像处理和机器学习算法，能够识别和提取文档中的文本块、标题、段落、图片、表格以及其他版面元素。此过程通常包括版面分析、元素分析和数据格式化三个主要步骤，最终生成结构化的文档数据，提升数据处理的效率和准确性。通用版面解析v3产线在通用版面解析v1产线的基础上，强化了版面区域检测、表格识别、公式识别的能力，增加了图表理解能力和多栏阅读顺序的恢复能力、结果转换 Markdown 文件的能力，在多种文档数据中，表现优异，可以处理较复杂的文档数据。"
  },
  "paths": {
    "/layout-parsing": {
      "post": {
        "operationId": "infer",
        "summary": "进行版面解析",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InferRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "请求成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "../common_api_responses.json#/components/schemas/SuccessResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "result": {
                          "$ref": "#/components/schemas/InferResult"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "InferRequest": {
        "type": "object",
        "properties": {
          "file": {
            "type": "string",
            "description": "服务器可访问的图像文件或PDF文件的URL，或上述类型文件内容的Base64编码结果。默认对于超过10页的PDF文件，只有前10页的内容会被处理。"
          },
          "fileType": {
            "oneOf": [
              {
                "type": "integer",
                "enum": [0, 1],
                "description": "文件类型。0表示PDF文件，1表示图像文件"
              },
              {
                "type": "null"
              }
            ],
            "description": "文件类型。0表示PDF文件，1表示图像文件。若请求体无此属性，则将根据URL推断文件类型。"
          },
          "useDocOrientationClassify": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用文档方向分类"
          },
          "useDocUnwarping": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用文档校正"
          },
          "useTextlineOrientation": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用文本行方向分类"
          },
          "useSealRecognition": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用印章识别"
          },
          "useTableRecognition": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用表格识别"
          },
          "useFormulaRecognition": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用公式识别"
          },
          "useChartRecognition": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用图表识别"
          },
          "useRegionDetection": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用区域检测"
          },
          "layoutThreshold": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "版面检测阈值"
          },
          "layoutNms": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用版面NMS"
          },
          "layoutUnclipRatio": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "array",
                "items": {
                  "type": "number"
                }
              },
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "版面检测非裁剪比例"
          },
          "layoutMergeBboxesMode": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "版面合并框模式"
          },
          "textDetLimitSideLen": {
            "oneOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本检测限制边长"
          },
          "textDetLimitType": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本检测限制类型"
          },
          "textDetThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本检测阈值"
          },
          "textDetBoxThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本检测框阈值"
          },
          "textDetUnclipRatio": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本检测非裁剪比例"
          },
          "textRecScoreThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "文本识别分数阈值"
          },
          "sealDetLimitSideLen": {
            "oneOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章检测限制边长"
          },
          "sealDetLimitType": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章检测限制类型"
          },
          "sealDetThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章检测阈值"
          },
          "sealDetBoxThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章检测框阈值"
          },
          "sealDetUnclipRatio": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章检测非裁剪比例"
          },
          "sealRecScoreThresh": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "印章识别分数阈值"
          },
          "useWiredTableCellsTransToHtml": {
            "type": "boolean",
            "description": "是否将有线表格单元格转换为HTML"
          },
          "useWirelessTableCellsTransToHtml": {
            "type": "boolean",
            "description": "是否将无线表格单元格转换为HTML"
          },
          "useTableOrientationClassify": {
            "type": "boolean",
            "description": "是否使用表格方向分类"
          },
          "useOcrResultsWithTableCells": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用表格单元格的OCR结果"
          },
          "useE2eWiredTableRecModel": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用端到端有线表格识别模型"
          },
          "useE2eWirelessTableRecModel": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否使用端到端无线表格识别模型"
          },
          "visualize": {
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "description": "是否返回可视化结果图以及处理过程中的中间图像等"
          }
        },
        "required": ["file"]
      },
      "InferResult": {
        "type": "object",
        "properties": {
          "layoutParsingResults": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LayoutParsingResult"
            },
            "description": "版面解析结果。数组长度为1（对于图像输入）或实际处理的文档页数（对于PDF输入）"
          },
          "dataInfo": {
            "type": "object",
            "description": "输入数据信息"
          }
        },
        "required": ["layoutParsingResults", "dataInfo"]
      },
      "LayoutParsingResult": {
        "type": "object",
        "properties": {
          "prunedResult": {
            "type": "object",
            "description": "产线对象的predict方法生成结果的JSON表示中res字段的简化版本"
          },
          "markdown": {
            "$ref": "#/components/schemas/Markdown"
          },
          "outputImages": {
            "oneOf": [
              {
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "输出图像。图像为JPEG格式，使用Base64编码"
          },
          "inputImage": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "description": "输入图像。图像为JPEG格式，使用Base64编码"
          }
        },
        "required": ["prunedResult", "markdown"]
      },
      "Markdown": {
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "description": "Markdown文本"
          },
          "images": {
            "type": "object",
            "description": "Markdown图片相对路径和Base64编码图像的键值对"
          },
          "isStart": {
            "type": "boolean",
            "description": "当前页面第一个元素是否为段开始"
          },
          "isEnd": {
            "type": "boolean",
            "description": "当前页面最后一个元素是否为段结束"
          }
        },
        "required": ["text", "images", "isStart", "isEnd"]
      }
    }
  }
}