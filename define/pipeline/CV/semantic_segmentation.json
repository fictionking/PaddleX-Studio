{
  "openapi": "3.0.0",
  "info": {
    "title": "通用语义分割产线",
    "description": "语义分割是一种计算机视觉技术，旨在将图像中的每个像素分配到特定的类别，从而实现对图像内容的精细化理解。语义分割不仅要识别出图像中的物体类型，还要对每个像素进行分类，这样使得同一类别的区域能够被完整标记。例如，在一幅街景图像中，语义分割可以将行人、汽车、天空和道路等不同类别的部分逐像素区分开来，形成一个详细的标签图。通用语义分割产线用于解决像素级别的图像理解问题，这项技术广泛应用于自动驾驶、医学影像分析和人机交互等领域，通常依赖于深度学习模型（如SegFormer等），通过卷积神经网络（CNN）或视觉变换器（Transformer）来提取特征并实现高精度的像素级分类，从而为进一步的智能分析提供基础。"
  },
  "paths": {
    "/semantic-segmentation": {
      "post": {
        "operationId": "infer",
        "summary": "对图像进行语义分割",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "image": {
                    "type": "string",
                    "description": "服务器可访问的图像文件的URL或图像文件内容的Base64编码结果。"
                  },
                  "targetSize": {
                    "oneOf": [
                      {"type": "integer"},
                      {"type": "array",
                        "items": {
                          "type": "integer"
                        }
                      },
                      {"type": "null"}
                    ],
                    "description": "请参阅产线对象中 predict 方法的 target_size 参数相关说明。"
                  },
                  "visualize": {
                    "oneOf": [
                      {"type": "boolean"},
                      {"type": "null"}
                    ],
                    "description": "是否返回可视化结果图以及处理过程中的中间图像等。传入 true：返回图像；传入 false：不返回图像；若请求体中未提供该参数或传入 null：遵循产线配置文件Serving.visualize 的设置。如果请求体和配置文件中均未设置（或请求体传入null、配置文件中未设置），则默认返回图像。"
                  }
                },
                "required": ["image"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "请求成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {"$ref": "../common_api_responses.json#/components/schemas/SuccessResponse"},
                    {
                      "type": "object",
                      "properties": {
                        "result": {
                          "$ref": "#/components/schemas/InferResult"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "InferResult": {
        "type": "object",
        "description": "语义分割结果",
        "properties": {
          "labelMap": {
            "type": "array",
            "description": "记录图像中每个像素的类别标签（按照行优先顺序排列）。",
            "items": {
              "type": "integer"
            }
          },
          "size": {
            "type": "array",
            "description": "图像形状。数组中元素依次为图像的高度和宽度。",
            "items": {
              "type": "integer"
            },
            "minItems": 2,
            "maxItems": 2
          },
          "image": {
            "oneOf": [
              {"type": "string"},
              {"type": "null"}
            ],
            "description": "语义分割结果图。图像为JPEG格式，使用Base64编码。"
          }
        },
        "required": ["labelMap", "size", "image"]
      }
    }
  }
}