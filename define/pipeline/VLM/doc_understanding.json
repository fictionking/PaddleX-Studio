{
  "openapi": "3.0.0",
  "info": {
    "title": "文档理解产线",
    "description": "文档理解产线是基于视觉-语言模型（VLM）打造的先进文档处理技术，旨在突破传统文档处理的局限。传统方法依赖固定模板或预定义规则解析文档，而该产线借助VLM的多模态能力，仅需输入文档图片和用户问题，即可通过融合视觉与语言信息，精准回答用户提问。这种技术无需针对特定文档格式预训练，能够灵活应对多样化文档内容，显著提升文档处理的泛化性与实用性，在智能问答、信息提取等场景中具有广阔应用前景。"
  },
  "paths": {
    "/document-understanding": {
      "post": {
        "operationId": "infer",
        "summary": "文档理解",
        "description": "对输入消息进行推理生成响应。此接口别名/chat/completion，是openai兼容的接口。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InferRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功响应",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "../common_api_responses.json#/components/schemas/SuccessResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "result": {
                          "$ref": "#/components/schemas/InferResult"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../common_api_responses.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "InferRequest": {
        "type": "object",
        "description": "文档理解请求",
        "properties": {
          "model": {
            "type": "string",
            "description": "要使用的模型名称"
          },
          "messages": {
            "type": "array",
            "description": "对话消息列表",
            "items": {
              "$ref": "#/components/schemas/Message"
            }
          },
          "max_tokens": {
            "type": "integer",
            "description": "生成的最大token数",
            "default": 1024
          },
          "temperature": {
            "type": "number",
            "description": "采样温度",
            "default": 0.1
          },
          "top_p": {
            "type": "number",
            "description": "核心采样概率",
            "default": 0.95
          },
          "stream": {
            "type": "boolean",
            "description": "是否流式输出",
            "default": false
          },
          "max_image_tokens": {
            "type": "integer",
            "description": "图像的最大输入token数",
            "nullable": true
          }
        },
        "required": ["model", "messages"]
      },
      "Message": {
        "type": "object",
        "description": "对话消息",
        "properties": {
          "role": {
            "type": "string",
            "description": "消息角色",
            "enum": ["user", "assistant", "system"]
          },
          "content": {
            "oneOf": [
              {
                "type": "string",
                "description": "文本内容"
              },
              {
                "type": "array",
                "description": "图文混合内容",
                "items": {
                  "$ref": "#/components/schemas/ContentItem"
                }
              }
            ]
          }
        },
        "required": ["role", "content"]
      },
      "ContentItem": {
        "type": "object",
        "description": "内容项",
        "properties": {
          "type": {
            "type": "string",
            "description": "内容类型",
            "enum": ["text", "image_url"]
          },
          "text": {
            "type": "string",
            "description": "文本内容（当type为text时）"
          },
          "image_url": {
            "oneOf": [
              {
                "type": "string",
                "description": "图片URL"
              },
              {
                "$ref": "#/components/schemas/ImageUrlObject"
              }
            ],
            "description": "图片URL或对象（当type为image_url时）"
          }
        },
        "required": ["type"],
        "allOf": [
          {
            "if": {
              "properties": {
                "type": {
                  "const": "text"
                }
              }
            },
            "then": {
              "required": ["text"]
            }
          },
          {
            "if": {
              "properties": {
                "type": {
                  "const": "image_url"
                }
              }
            },
            "then": {
              "required": ["image_url"]
            }
          }
        ]
      },
      "ImageUrlObject": {
        "type": "object",
        "description": "图片URL对象",
        "properties": {
          "url": {
            "type": "string",
            "description": "图片URL"
          },
          "detail": {
            "type": "string",
            "description": "图片细节处理方式",
            "enum": ["low", "high", "auto"],
            "default": "auto"
          }
        },
        "required": ["url"]
      },
      "InferResult": {
        "type": "object",
        "description": "文档理解结果",
        "properties": {
          "id": {
            "type": "string",
            "description": "请求ID"
          },
          "object": {
            "type": "string",
            "description": "对象类型",
            "enum": ["chat.completion"]
          },
          "created": {
            "type": "integer",
            "description": "创建时间戳"
          },
          "choices": {
            "type": "array",
            "description": "生成结果选项",
            "items": {
              "$ref": "#/components/schemas/Choice"
            }
          },
          "usage": {
            "$ref": "#/components/schemas/Usage"
          }
        },
        "required": ["id", "object", "created", "choices", "usage"]
      },
      "Choice": {
        "type": "object",
        "description": "生成结果选项",
        "properties": {
          "finish_reason": {
            "type": "string",
            "description": "模型停止生成token的原因",
            "enum": ["stop", "length", "tool_calls", "content_filter", "function_call"]
          },
          "index": {
            "type": "integer",
            "description": "选项在列表中的索引"
          },
          "logprobs": {
            "type": "object",
            "description": "选项的log概率信息",
            "nullable": true
          },
          "message": {
            "$ref": "#/components/schemas/ChatCompletionMessage"
          }
        },
        "required": ["finish_reason", "index", "message"]
      },
      "ChatCompletionMessage": {
        "type": "object",
        "description": "模型生成的聊天消息",
        "properties": {
          "content": {
            "type": "string",
            "description": "消息内容",
            "nullable": true
          },
          "refusal": {
            "type": "string",
            "description": "模型生成的拒绝消息",
            "nullable": true
          },
          "role": {
            "type": "string",
            "description": "消息作者角色",
            "enum": ["assistant"]
          },
          "audio": {
            "type": "object",
            "description": "音频输出数据",
            "nullable": true
          },
          "function_call": {
            "type": "object",
            "description": "应调用的函数名称和参数",
            "nullable": true
          },
          "tool_calls": {
            "type": "array",
            "description": "模型生成的工具调用",
            "nullable": true,
            "items": {
              "type": "object"
            }
          }
        },
        "required": ["role"]
      },
      "Usage": {
        "type": "object",
        "description": "token使用情况",
        "properties": {
          "prompt_tokens": {
            "type": "integer",
            "description": "提示token数"
          },
          "completion_tokens": {
            "type": "integer",
            "description": "生成token数"
          },
          "total_tokens": {
            "type": "integer",
            "description": "总token数"
          }
        },
        "required": ["prompt_tokens", "completion_tokens", "total_tokens"]
      }
    }
  }
}